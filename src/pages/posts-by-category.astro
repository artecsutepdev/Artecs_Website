---
import type { CollectionEntry } from "astro:content";
import { getAllPosts, groupPostsByCategory } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import PostPreview from "@/components/blog/PostPreview.astro";
import { collectionDateSort } from "@/utils/date";

const allPosts = await getAllPosts();
const sorted = allPosts.sort(collectionDateSort);
const grouped = groupPostsByCategory(sorted);
const categories = Object.keys(grouped).sort((a, b) => a.localeCompare(b));

---

<PageLayout meta={{ title: "Posts grouped by category", description: "All posts grouped by their categories." }}>
  <h1 class="mb-6">Posts grouped by category</h1>

  {categories.map((category) => (
    <section id={`category-${category}`} class="mb-10">
      <h2 class="mb-3 capitalize">{category} <span class="text-sm text-muted">({grouped[category].length})</span></h2>
      <ul class="space-y-4">
        {grouped[category].map((post: CollectionEntry<"post">) => (
          <li class="grid gap-2 sm:grid-cols-[auto_1fr]">
            <PostPreview as="h3" post={post} />
          </li>
        ))}
      </ul>
    </section>
  ))}
</PageLayout>