---
import { type CollectionEntry, getCollection } from "astro:content";
import SocialList from "@/components/SocialList.astro";
import PostPreview from "@/components/blog/PostPreview.astro";
import Note from "@/components/note/Note.astro";
import { getAllPosts, groupPostsByCategory } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";

// Posts grouped by category
const MAX_POSTS_PER_CATEGORY = 5;
const allPosts = await getAllPosts();
const sortedPosts = allPosts.sort(collectionDateSort);
const groupedPosts = groupPostsByCategory(sortedPosts);

// Custom category order: Game Development first, then Creative Programming, then Electronics
const categoryOrder = ["Game Development", "Creative Programming", "Electronics"];
const availableCategories = Object.keys(groupedPosts);
const categories = [
	...categoryOrder.filter(cat => availableCategories.includes(cat)),
	...availableCategories.filter(cat => !categoryOrder.includes(cat)).sort()
];

// Notes
const MAX_NOTES = 5;
const allNotes = await getCollection("note");
const latestNotes = allNotes.sort(collectionDateSort).slice(0, MAX_NOTES);
---

<PageLayout meta={{ title: "Home" }}>
	<section>
		<h1 class="title mb-6">Hello World!</h1>
		<p class="mb-4">
			We are ARTECS, a student organization at The University of Texas at El Paso (UTEP) dedicated to exploring and advancing the integration of art and computer science.
			We believe in the power of creativity, innovation, and collaboration to push the boundaries of what's possible.  
		</p>
		<SocialList />
	</section>
	<section class="mt-16">
		<h2 class="title text-accent mb-6 text-xl"><a href="/posts/">Posts</a></h2>
		{categories.map((category) => (
			<div class="mb-8">
				<h3 class="mb-4 text-lg font-semibold capitalize text-accent-2">{category}</h3>
				<ul class="space-y-4" role="list">
					{groupedPosts[category].slice(0, MAX_POSTS_PER_CATEGORY).map((post) => (
						<li class="grid gap-2 sm:grid-cols-[auto_1fr]">
							<PostPreview post={post} />
						</li>
					))}
				</ul>
				{groupedPosts[category].length > MAX_POSTS_PER_CATEGORY && (
					<div class="mt-3">
						<a href={`/posts-by-category#category-${category}`} class="text-sm text-accent hover:underline">
							View all {groupedPosts[category].length} {category} posts â†’
						</a>
					</div>
				)}
			</div>
		))}
	</section>
	{
		latestNotes.length > 0 && (
			<section class="mt-16">
				<h2 class="title text-accent mb-6 text-xl">
					<a href="/notes/">Notes</a>
				</h2>
				<ul class="space-y-4" role="list">
					{latestNotes.map((note) => (
						<li>
							<Note note={note} as="h3" isPreview />
						</li>
					))}
				</ul>
			</section>
		)
	}
</PageLayout>
